/**
 * Another angular directive for selecting date and time ranges
 * @version v0.1.0 - 2015-08-18
 * @author Gabriela Vazquez <gabs.vz@gmail.com>
 **/
(function(){"use strict";function a(a,c,d){function e(a){return"hour"===a.duration.unit||"minutes"===a.duration.unit||"day"==a.duration.unit&&1==a.duration.value?!0:!1}function f(a,b){var c=new d(a),e=new d(b);return e.diff(c,"hours")}function g(a){var b=a||new Date,c=b+"",d=c.match(/\(([^\)]+)\)$/)||c.match(/([A-Z]+) [\d]{4}$/);return d&&(d=d[1].match(/[A-Z]/g).join("")),d||(d=""),d}function h(a,b,e){function f(a){var b=k.indexOf(a);return 0>b||b>k.length-2?k[k.length-1]:k[b+1]}function g(a){switch(a){case"second":return 1e3;case"minute":return 6e4;case"hour":return 36e5;case"day":return 864e5;case"week":return 6048e5;case"month":return 2592e6;default:return NaN}}function h(a){if(c.isUndefined(a)&&(a=j.timeUnit),k.indexOf(a)<0)return void 0;var b=g(a),e=d(j.from).toDate().getTime(),f=d(j.to).toDate().getTime(),h=f-e;return Math.floor(h/b)}function i(a){var b=h(a);return b?h(a)<j.maxResolution:!1}var j,k=["second","minute","hour","day","week","month"];return j={from:a,to:b,timeUnit:e||"second",maxResolution:200,selectedRange:"custom",suggestedTimeUnit:function(){for(var a=j.timeUnit,b=k[k.length-1];a!==b&&!i(a);)a=f(a);return a},suggestedRange:function(){var a=j.suggestedTimeUnit(),b={from:d(j.from).startOf(a).valueOf(),to:d(j.to).startOf(a).valueOf(),intersects:function(a){return d(a).valueOf()>=b.from&&d(a).valueOf()<=b.to}};return b}}}function i(a,b){var c,e,f;if(a.duration&&0===a.duration.offset)c=d(),e=d().startOf(a.duration.unit).subtract(a.duration.value-1,a.duration.unit);else if(a.duration&&a.duration.offset>0){var g=(new d).subtract(a.duration.offset,a.duration.unit),i=(new d).subtract(a.duration.offset-1,a.duration.unit);e=d(g).startOf(a.duration.unit),c=d(i).startOf(a.duration.unit)}else c=d(),e=d().subtract(a.duration.value,a.duration.unit);f=h(e.valueOf(),c.valueOf());var j=b||f.suggestedTimeUnit();return f.to=d(f.to).startOf(j).valueOf(),f.from=d(f.to).subtract(a.duration.value,a.duration.unit).valueOf(),f.timeUnit=j,f.selectedRange=a,f}var j=[{label:"Last Hour",duration:{unit:"hour",value:1}},{label:"Last 24 Hours",duration:{unit:"day",value:1},preselected:!0},{label:"Yesterday",duration:{unit:"day",value:1,offset:1}},{label:"Last 7 Days",duration:{unit:"week",value:1}},{label:"Date Range",custom:"date"},{label:"Time Range",custom:"time"}],k=[{value:0,label:"0:00"},{value:1,label:"1:00"},{value:2,label:"2:00"},{value:3,label:"3:00"},{value:4,label:"4:00"},{value:5,label:"5:00"},{value:6,label:"6:00"},{value:7,label:"7:00"},{value:8,label:"8:00"},{value:9,label:"9:00"},{value:10,label:"10:00"},{value:11,label:"11:00"},{value:12,label:"12:00"},{value:13,label:"13:00"},{value:14,label:"14:00"},{value:15,label:"15:00"},{value:16,label:"16:00"},{value:17,label:"17:00"},{value:18,label:"18:00"},{value:19,label:"19:00"},{value:20,label:"20:00"},{value:21,label:"21:00"},{value:22,label:"22:00"},{value:23,label:"23:00"}],l=[{value:1,unit:"hours",label:"1 hour"},{value:2,unit:"hours",label:"2 hours"},{value:3,unit:"hours",label:"3 hours"},{value:6,unit:"hours",label:"6 hours"},{value:12,unit:"hours",label:"12 hours"},{value:24,unit:"hours",label:"24 hours"},{value:48,unit:"hours",label:"48 hours"}];return b(a),{restrict:"E",replace:!0,templateUrl:"date-time-picker.html",scope:{range:"=",options:"=",rangeDictionary:"="},link:function(b,m){function n(a,c){var e=d(c).diff(d(a),"hours");e>36&&200>e?b.internalRangeObject.selectedRange.timeUnits=["hour","day"]:delete b.internalRangeObject.selectedRange.timeUnits}function o(){if("Time Range"===b.internalRangeObject.selectedRange.label){var e=d(b.internalRangeObject.from),g=d(b.internalRangeObject.to);b.selectedFrom=c.find(b.hours,{value:e.hour()}),10===g.diff(e,"minutes")?b.selectedDuration=c.find(b.durations,{value:10,unit:"minutes"}):b.selectedDuration=c.find(b.durations,{value:g.diff(e,"hours"),unit:"hours"})}else if("Last Hour"===b.internalRangeObject.selectedRange.label)b.selectedFrom=c.find(b.hours,{value:-1}),b.selectedDuration=c.find(b.durations,{value:1,unit:"hours"});else if("Last 10 Minutes"===b.internalRangeObject.selectedRange.label)b.selectedFrom=c.find(b.hours,{value:-10}),b.selectedDuration=c.find(b.durations,{value:10,unit:"minutes"});else{var h=new d(b.internalRangeObject.suggestedRange().from).hour();b.selectedFrom=c.find(b.hours,{value:h});var i=f(b.internalRangeObject.from,b.internalRangeObject.to);b.selectedDuration=c.find(b.durations,{value:i,unit:"hours"})}var j=new Date(b.internalRangeObject.suggestedRange().from);u=!0,a(m.find(".single-calendar-container")).datepick("setDate",j)}function p(){var c=b.internalRangeObject.suggestedRange().from,e=new Date(c),f=d(c).month(),g=d(c).year(),h=new Date(b.internalRangeObject.suggestedRange().to);w=!1,v=!0,a(m.find(".double-calendar-container")).datepick("option","minDate","-6m"),a(m.find(".double-calendar-container")).datepick("option","maxDate",0),a(m.find(".double-calendar-container")).datepick("setDate",e,h),a(m.find(".double-calendar-container")).datepick("showMonth",g,f),n(b.internalRangeObject.suggestedRange().from,b.internalRangeObject.suggestedRange().to)}function q(){b.isTimeRange?o():p()}function r(a){if(b.internalRangeObject.selectedRange){if(b.internalRangeObject.selectedRange.custom){if("date"===b.internalRangeObject.selectedRange.custom){if(b.isTimeRange){var f=new d(b.internalRangeObject.from).startOf("day"),g=new d(b.internalRangeObject.to).endOf("day");b.internalRangeObject=h(f.valueOf(),g.valueOf()),b.internalRangeObject.selectedRange=c.find(b.dictionary,{custom:"date"}),b.isTimeRange=!1}}else if(!b.isTimeRange){var f=new d(b.internalRangeObject.from).startOf("day"),g=new d(b.internalRangeObject.from).startOf("day").add(1,"day");b.internalRangeObject=h(f.valueOf(),g.valueOf()),b.internalRangeObject.selectedRange=c.find(b.dictionary,{custom:"time"}),b.isTimeRange=!0}}else b.internalRangeObject=i(b.internalRangeObject.selectedRange,a?b.internalRangeObject.timeUnit:!1),b.isTimeRange=e(b.internalRangeObject.selectedRange);a||(b.internalRangeObject.timeUnit=b.internalRangeObject.suggestedTimeUnit())}}function s(a,d,e){b.internalRangeObject=h(a,d),b.internalRangeObject.selectedRange=c.find(b.dictionary,e),b.internalRangeObject.timeUnit=b.internalRangeObject.suggestedTimeUnit()}function t(){a(m.find(".single-calendar-container")).datepick({minDate:"-6m",maxDate:0,changeMonth:!1,dayNamesMin:["S","M","T","W","T","F","S"],prevText:'<span class="datepickImagePrevious"></span><span class="datepickTextNextPrevious">Prev</span>',nextText:'<span class="datepickTextNextPrevious">Next</span><span class="datepickImageNext"></span>',onSelect:b.singleDateSelected}),a(m.find(".double-calendar-container")).datepick({rangeSelect:!0,monthsToShow:2,minDate:"-6m",maxDate:0,changeMonth:!1,dayNamesMin:["S","M","T","W","T","F","S"],prevText:'<span class="datepickImagePrevious"></span><span class="datepickTextNextPrevious">Prev</span>',nextText:'<span class="datepickTextNextPrevious">Next</span><span class="datepickImageNext"></span>',onSelect:b.dateRangeSelected}),b.rangeDictionary?b.dictionary=b.rangeDictionary:b.dictionary=j;var d=[],e=[];c.find(b.dictionary,{label:"Last 10 Minutes"})&&(d.push({value:-10,unit:"minute",label:"Ten minutes ago"}),e.push({value:10,unit:"minutes",label:"10 minutes"})),c.find(b.dictionary,{label:"Last Hour"})&&d.push({value:-1,unit:"hour",label:"An hour ago"}),b.hours=d.concat(k),b.durations=e.concat(l),b.options&&b.options.hideCustom&&c.remove(b.dictionary,{custom:"date"}),b.options&&b.options.hideTimeUnit&&(b.hideTimeUnit=!0),b.maxRange=b.options&&b.options.maxRange||31,b.internalRangeObject={},b.selectRangeOption(c.find(b.dictionary,{preselected:!0})||b.dictionary[0]),b.threeLetterTimezoneLabel=g();var f=i(b.internalRangeObject.selectedRange);b.range={from:f.from,to:f.to,timeUnit:f.suggestedTimeUnit()},b.savedRange=b.internalRangeObject.selectedRange}var u,v;b.singleDateSelected=function(a){if(a&&a[0]){if(u)return void(u=!1);var c=new d(a[0]),e=new d(b.internalRangeObject.from);e.year(c.year()).month(c.month()).date(c.date());var f=new d(e.valueOf()).add(b.selectedDuration.value,"hours");s(e.valueOf(),f.valueOf(),{custom:"time"}),b.$apply()}};var w;b.dateRangeSelected=function(e){if(e&&e.length){if(v)return void(v=!1);var f,g;if(w)f=w,g=d(e[1]).endOf("day").valueOf(),a(m.find(".double-calendar-container")).datepick("option","minDate","-6m"),a(m.find(".double-calendar-container")).datepick("option","maxDate",0),a(m.find(".double-calendar-container")).datepick("setDate",new Date(f),new Date(g)),w=!1;else{f=d(e[0]).startOf("day").valueOf(),g=d(e[1]).endOf("day").valueOf(),w=f;var h=d(f).add(b.maxRange,"days").valueOf(),i=c.min([h,d().valueOf()]);a(m.find(".double-calendar-container")).datepick("option","minDate",new Date(f)),a(m.find(".double-calendar-container")).datepick("option","maxDate",new Date(i))}s(f,g,{custom:"date"}),n(f,g),b.$apply()}},b.selectRangeOption=function(a){b.internalRangeObject.selectedRange=a,r(),q()},b.configure=function(){b.internalRangeObject.selectedRange=b.savedRange,b.internalRangeObject.from=b.range.from,b.internalRangeObject.to=b.range.to,b.internalRangeObject.timeUnit=b.range.timeUnit,r(!0),q(),b.configuring=!0},b.selectFrom=function(a){if(-1===a.value)b.selectRangeOption(c.find(b.dictionary,{label:"Last Hour"}));else if(-10===a.value)b.selectRangeOption(c.find(b.dictionary,{label:"Last 10 Minutes"}));else{b.selectedFrom=a;var e=new d(b.internalRangeObject.from);e.hour(a.value).minute(0).second(0).millisecond(0);var f=new d(e.valueOf()).add(b.selectedDuration.value,b.selectedDuration.unit);s(e.valueOf(),f.valueOf(),{custom:"time"})}},b.selectDuration=function(a){b.selectedDuration=a;var c=new d(b.internalRangeObject.from).add(b.selectedDuration.value,b.selectedDuration.unit);s(b.internalRangeObject.from,c.valueOf(),{custom:"time"})},b.selectTimeUnit=function(a){b.internalRangeObject.timeUnit=a,r(!0)},b.close=function(){b.configuring=!1},b.refresh=function(){b.internalRangeObject.selectedRange=b.savedRange,r(!0),b.save()},b.save=function(){b.savedRange=b.internalRangeObject.selectedRange,b.range.from=b.internalRangeObject.from,b.range.to=b.internalRangeObject.to,b.range.timeUnit=b.internalRangeObject.timeUnit,b.configuring=!1},t()}}}function b(a){if("undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");!function(a){var b=a.fn.jquery.split(" ")[0].split(".");if(b[0]<2&&b[1]<9||1==b[0]&&9==b[1]&&b[2]<1)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher")}(jQuery),function(a){function b(b){var c=b.attr("data-target");c||(c=b.attr("href"),c=c&&/#[A-Za-z]/.test(c)&&c.replace(/.*(?=#[^\s]*$)/,""));var d=c&&a(c);return d&&d.length?d:b.parent()}function c(c){c&&3===c.which||(a(e).remove(),a(f).each(function(){var d=a(this),e=b(d),f={relatedTarget:this};e.hasClass("open")&&(c&&"click"==c.type&&/input|textarea/i.test(c.target.tagName)&&a.contains(e[0],c.target)||(e.trigger(c=a.Event("hide.dt.dropdown",f)),c.isDefaultPrevented()||(d.attr("aria-expanded","false"),e.removeClass("open").trigger("hidden.dt.dropdown",f))))}))}function d(b){return this.each(function(){var c=a(this),d=c.data("dt.dropdown");d||c.data("dt.dropdown",d=new g(this)),"string"==typeof b&&d[b].call(c)})}var e=".dropdown-backdrop",f='[data-toggle="dt_dropdown"]',g=function(b){a(b).on("click.dt.dropdown",this.toggle)};g.VERSION="3.3.5",g.prototype.toggle=function(d){var e=a(this);if(!e.is(".disabled, :disabled")){var f=b(e),g=f.hasClass("open");if(c(),!g){"ontouchstart"in document.documentElement&&!f.closest(".navbar-nav").length&&a(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(a(this)).on("click",c);var h={relatedTarget:this};if(f.trigger(d=a.Event("show.dt.dropdown",h)),d.isDefaultPrevented())return;e.trigger("focus").attr("aria-expanded","true"),f.toggleClass("open").trigger("shown.dt.dropdown",h)}return!1}},g.prototype.keydown=function(c){if(/(38|40|27|32)/.test(c.which)&&!/input|textarea/i.test(c.target.tagName)){var d=a(this);if(c.preventDefault(),c.stopPropagation(),!d.is(".disabled, :disabled")){var e=b(d),g=e.hasClass("open");if(!g&&27!=c.which||g&&27==c.which)return 27==c.which&&e.find(f).trigger("focus"),d.trigger("click");var h=" li:not(.disabled):visible a",i=e.find(".dropdown-menu"+h);if(i.length){var j=i.index(c.target);38==c.which&&j>0&&j--,40==c.which&&j<i.length-1&&j++,~j||(j=0),i.eq(j).trigger("focus")}}}};var h=a.fn.dt_dropdown;a.fn.dt_dropdown=d,a.fn.dt_dropdown.Constructor=g,a.fn.dt_dropdown.noConflict=function(){return a.fn.dt_dropdown=h,this},a(document).on("click.dt.dropdown.data-api",c).on("click.dt.dropdown.data-api",".dropdown form",function(a){a.stopPropagation()}).on("click.dt.dropdown.data-api",f,g.prototype.toggle).on("keydown.dt.dropdown.data-api",f,g.prototype.keydown).on("keydown.dt.dropdown.data-api",".dropdown-menu",g.prototype.keydown)}(jQuery)}function c(b,c,f,g){e(c);var h=b.module("dt-picker",[]);return h.run(["$templateCache",d]),h.factory("jQuery",[function(){return c}]),h.factory("lodash",[function(){return f}]),h.factory("moment",[function(){return g}]),h.factory("dtPicker.service",[function(){return{version:"0.1.0"}}]),h.directive("dtPicker",["jQuery","lodash","moment",a]),h}function d(a){a.put("date-time-picker.html",'<div class="date-time-picker">\n    <div>\n        <div class="main-label-container">\n            <a class="main-date-time-label" ng-class="configuring ? \'configuring\' : \'closed\'" ng-click="configure()">\n                <span class="dt-lighter">{{ range.from | date: \'EEE\' }}</span>\n                <span class="dt-bolder">{{ range.from | date: \'d MMM yyyy\' }}</span>\n                <span class="dt-lighter">{{ range.from | date: \'H:mm\' }}</span>\n                <span class="dt-bolder">&nbsp;&ndash;&nbsp;</span>\n                <span class="dt-lighter">{{ range.to | date: \'EEE\' }}</span>\n                <span class="dt-bolder">{{ range.to | date: \'d MMM yyyy\' }}</span>\n                <span class="dt-lighter">{{ range.to | date: \'H:mm\' }}</span>\n                <span class="dt-lighter">{{ threeLetterTimezoneLabel }}</span>\n            </a>\n        </div>\n        <button class="btn-refresh btn btn-sm" href="" ng-click="refresh()"><i class="icon-refresh"></i></button>\n        <div class="clearboth"></div>\n    </div>\n    <div class="date-time-configure" ng-show="configuring">\n        <div class="sections">\n            <div class="date-range-selection" ng-hide="isTimeRange">\n                <div class="double-calendar-container"></div>\n            </div>\n            <div class="time-range-selection" ng-show="isTimeRange">\n                <div class="single-calendar-container"></div>\n                <div class="time-range-container">\n                    <div class="key-value-section">\n                        <span class="bold-label">From</span>\n                        <div class="btn-group">\n                            <button class="btn btn-sm dropdown-toggle" data-toggle="dt_dropdown">{{ selectedFrom.label }}<span class="caret"></span></button>\n                            <ul class="dropdown-menu">\n                                <li ng-repeat="hour in hours" ng-click="selectFrom(hour)"><a>{{ hour.label }}</a></li>\n                            </ul>\n                        </div>\n                    </div>\n                    <div class="key-value-section">\n                        <span class="bold-label">Duration</span>\n                        <div class="btn-group">\n                            <button class="btn btn-sm dropdown-toggle" data-toggle="dt_dropdown">{{ selectedDuration.label }}<span class="caret"></span></button>\n                            <ul class="dropdown-menu">\n                                <li ng-repeat="duration in durations" ng-click="selectDuration(duration)"><a>{{ duration.label }}</a></li>\n                            </ul>\n                        </div>\n                    </div>\n                    <div class="key-value-section">\n                        <span class="bold-label">To</span>\n                        <span class="label-text to-value">{{ internalRangeObject.suggestedRange().to | date: \'H:mm\' }}</span>\n                    </div>\n                </div>\n            </div>\n            <div class="section-configure">\n                <div class="key-value-section">\n                    <span class="bold-label">Range</span>\n                    <div class="btn-group">\n                        <button class="btn btn-sm dropdown-toggle" data-toggle="dt_dropdown">{{ internalRangeObject.selectedRange.label }}<span class="caret"></span></button>\n                        <ul class="dropdown-menu">\n                            <li ng-repeat="range in dictionary"><a ng-click="selectRangeOption(range)">{{ range.label }}</a></li>\n                        </ul>\n                    </div>\n                </div>\n                <div class="key-value-section" ng-hide="hideTimeUnit">\n                    <span class="bold-label">Time Unit</span>\n                    <span class="label-text" ng-hide="internalRangeObject.selectedRange.timeUnits.length > 1">{{ internalRangeObject.timeUnit }}</span>\n                    <div class="btn-group" ng-show="internalRangeObject.selectedRange.timeUnits.length > 1">\n                        <button class="btn btn-sm dropdown-toggle" data-toggle="dt_dropdown">{{ internalRangeObject.timeUnit }}<span class="caret"></span>\n                        </button>\n                        <ul class="dropdown-menu">\n                            <li ng-repeat="unit in internalRangeObject.selectedRange.timeUnits" ng-click="selectTimeUnit(unit)"><a>{{ unit }}</a></li>\n                        </ul>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="bottom-section">\n            <div class="button-section">\n                <button class="btn btn-sm btn-save" ng-click="save()">Apply</button>\n                <button class="btn btn-sm" ng-click="close()">Cancel</button>\n            </div>\n            <div class="selected-section">\n                <span class="bold-label">Selected</span>\n                <span class="label-text">{{ internalRangeObject.suggestedRange().from | date: \'EEE d MMM yyyy H:mm\' }} &nbsp;&ndash;&nbsp; {{ internalRangeObject.suggestedRange().to | date: \'EEE d MMM yyyy H:mm\' }} {{ threeLetterTimezoneLabel }}</span>\n            </div>\n            <div class="clearboth"></div>\n        </div>\n    </div>\n</div>')}function e(a){!function(a){function b(){this._defaults={pickerClass:"",showOnFocus:!0,showTrigger:null,showAnim:"show",showOptions:{},showSpeed:"normal",popupContainer:null,alignment:"bottom",fixedWeeks:!1,firstDay:0,calculateWeek:this.iso8601Week,monthsToShow:1,monthsOffset:0,monthsToStep:1,monthsToJump:12,useMouseWheel:!0,changeMonth:!0,yearRange:"c-10:c+10",shortYearCutoff:"+10",showOtherMonths:!1,selectOtherMonths:!1,defaultDate:null,selectDefaultDate:!1,minDate:null,maxDate:null,dateFormat:"mm/dd/yyyy",autoSize:!1,rangeSelect:!1,rangeSeparator:" - ",multiSelect:0,multiSeparator:",",onDate:null,onShow:null,onChangeMonthYear:null,onSelect:null,onClose:null,altField:null,altFormat:null,constrainInput:!0,commandsAsDateFormat:!1,commands:this.commands},this.regional=[],this.regional[""]={monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],dateFormat:"mm/dd/yyyy",firstDay:0,renderer:this.defaultRenderer,prevText:"&lt;Prev",prevStatus:"Show the previous month",prevJumpText:"&lt;&lt;",prevJumpStatus:"Show the previous year",nextText:"Next&gt;",nextStatus:"Show the next month",nextJumpText:"&gt;&gt;",nextJumpStatus:"Show the next year",currentText:"Current",currentStatus:"Show the current month",todayText:"Today",todayStatus:"Show today's month",clearText:"Clear",clearStatus:"Clear all the dates",closeText:"Close",closeStatus:"Close the datepicker",yearStatus:"Change the year",monthStatus:"Change the month",weekText:"Wk",weekStatus:"Week of the year",dayStatus:"Select DD, M d, yyyy",defaultStatus:"Select a date",isRTL:!1},a.extend(this._defaults,this.regional[""]),this._disabled=[]}function c(b,c){return"option"==b&&(0==c.length||1==c.length&&"string"==typeof c[0])?!0:a.inArray(b,d)>-1}a.extend(b.prototype,{markerClassName:"hasDatepick",propertyName:"datepick",_popupClass:"datepick-popup",_triggerClass:"datepick-trigger",_disableClass:"datepick-disable",_monthYearClass:"datepick-month-year",_curMonthClass:"datepick-month-",_anyYearClass:"datepick-any-year",_curDoWClass:"datepick-dow-",commands:{prev:{text:"prevText",status:"prevStatus",keystroke:{keyCode:33},enabled:function(a){var b=a.curMinDate();return!b||e.add(e.day(e._applyMonthsOffset(e.add(e.newDate(a.drawDate),1-a.options.monthsToStep,"m"),a),1),-1,"d").getTime()>=b.getTime()},date:function(a){return e.day(e._applyMonthsOffset(e.add(e.newDate(a.drawDate),-a.options.monthsToStep,"m"),a),1)},action:function(a){e._changeMonthPlugin(this,-a.options.monthsToStep)}},prevJump:{text:"prevJumpText",status:"prevJumpStatus",keystroke:{keyCode:33,ctrlKey:!0},enabled:function(a){var b=a.curMinDate();return!b||e.add(e.day(e._applyMonthsOffset(e.add(e.newDate(a.drawDate),1-a.options.monthsToJump,"m"),a),1),-1,"d").getTime()>=b.getTime()},date:function(a){return e.day(e._applyMonthsOffset(e.add(e.newDate(a.drawDate),-a.options.monthsToJump,"m"),a),1)},action:function(a){e._changeMonthPlugin(this,-a.options.monthsToJump)}},next:{text:"nextText",status:"nextStatus",keystroke:{keyCode:34},enabled:function(a){var b=a.get("maxDate");return!b||e.day(e._applyMonthsOffset(e.add(e.newDate(a.drawDate),a.options.monthsToStep,"m"),a),1).getTime()<=b.getTime()},date:function(a){return e.day(e._applyMonthsOffset(e.add(e.newDate(a.drawDate),a.options.monthsToStep,"m"),a),1)},action:function(a){e._changeMonthPlugin(this,a.options.monthsToStep)}},nextJump:{text:"nextJumpText",status:"nextJumpStatus",keystroke:{keyCode:34,ctrlKey:!0},enabled:function(a){var b=a.get("maxDate");return!b||e.day(e._applyMonthsOffset(e.add(e.newDate(a.drawDate),a.options.monthsToJump,"m"),a),1).getTime()<=b.getTime()},date:function(a){return e.day(e._applyMonthsOffset(e.add(e.newDate(a.drawDate),a.options.monthsToJump,"m"),a),1)},action:function(a){e._changeMonthPlugin(this,a.options.monthsToJump)}},current:{text:"currentText",status:"currentStatus",keystroke:{keyCode:36,ctrlKey:!0},enabled:function(a){var b=a.curMinDate(),c=a.get("maxDate"),d=a.selectedDates[0]||e.today();return(!b||d.getTime()>=b.getTime())&&(!c||d.getTime()<=c.getTime())},date:function(a){return a.selectedDates[0]||e.today()},action:function(a){var b=a.selectedDates[0]||e.today();e._showMonthPlugin(this,b.getFullYear(),b.getMonth()+1)}},today:{text:"todayText",status:"todayStatus",keystroke:{keyCode:36,ctrlKey:!0},enabled:function(a){var b=a.curMinDate(),c=a.get("maxDate");return(!b||e.today().getTime()>=b.getTime())&&(!c||e.today().getTime()<=c.getTime())},date:function(a){return e.today()},action:function(a){e._showMonthPlugin(this)}},clear:{text:"clearText",status:"clearStatus",keystroke:{keyCode:35,ctrlKey:!0},enabled:function(a){return!0},date:function(a){return null},action:function(a){e._clearPlugin(this)}},close:{text:"closeText",status:"closeStatus",keystroke:{keyCode:27},enabled:function(a){return!0},date:function(a){return null},action:function(a){e._hidePlugin(this)}},prevWeek:{text:"prevWeekText",status:"prevWeekStatus",keystroke:{keyCode:38,ctrlKey:!0},enabled:function(a){var b=a.curMinDate();return!b||e.add(e.newDate(a.drawDate),-7,"d").getTime()>=b.getTime()},date:function(a){return e.add(e.newDate(a.drawDate),-7,"d")},action:function(a){e._changeDayPlugin(this,-7)}},prevDay:{text:"prevDayText",status:"prevDayStatus",keystroke:{keyCode:37,ctrlKey:!0},enabled:function(a){var b=a.curMinDate();return!b||e.add(e.newDate(a.drawDate),-1,"d").getTime()>=b.getTime()},date:function(a){return e.add(e.newDate(a.drawDate),-1,"d")},action:function(a){e._changeDayPlugin(this,-1)}},nextDay:{text:"nextDayText",status:"nextDayStatus",keystroke:{keyCode:39,ctrlKey:!0},enabled:function(a){var b=a.get("maxDate");return!b||e.add(e.newDate(a.drawDate),1,"d").getTime()<=b.getTime()},date:function(a){return e.add(e.newDate(a.drawDate),1,"d")},action:function(a){e._changeDayPlugin(this,1)}},nextWeek:{text:"nextWeekText",status:"nextWeekStatus",keystroke:{keyCode:40,ctrlKey:!0},enabled:function(a){var b=a.get("maxDate");return!b||e.add(e.newDate(a.drawDate),7,"d").getTime()<=b.getTime()},date:function(a){return e.add(e.newDate(a.drawDate),7,"d")},action:function(a){e._changeDayPlugin(this,7)}}},defaultRenderer:{picker:'<div class="datepick"><div class="datepick-nav">{link:prev}{link:today}{link:next}</div>{months}{popup:start}<div class="datepick-ctrl">{link:clear}{link:close}</div>{popup:end}<div class="datepick-clear-fix"></div></div>',monthRow:'<div class="datepick-month-row">{months}</div>',month:'<div class="datepick-month"><div class="datepick-month-header">{monthHeader}</div><table><thead>{weekHeader}</thead><tbody>{weeks}</tbody></table></div>',weekHeader:"<tr>{days}</tr>",dayHeader:"<th>{day}</th>",week:"<tr>{days}</tr>",day:"<td>{day}</td>",monthSelector:".datepick-month",daySelector:"td",rtlClass:"datepick-rtl",multiClass:"datepick-multi",defaultClass:"",selectedClass:"datepick-selected",highlightedClass:"datepick-highlight",todayClass:"datepick-today",otherMonthClass:"datepick-other-month",weekendClass:"datepick-weekend",commandClass:"datepick-cmd",commandButtonClass:"",commandLinkClass:"",disabledClass:"datepick-disabled"},setDefaults:function(b){return a.extend(this._defaults,b||{}),this},_ticksTo1970:24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*60*60*1e7,_msPerDay:864e5,ATOM:"yyyy-mm-dd",COOKIE:"D, dd M yyyy",FULL:"DD, MM d, yyyy",ISO_8601:"yyyy-mm-dd",JULIAN:"J",RFC_822:"D, d M yy",RFC_850:"DD, dd-M-yy",RFC_1036:"D, d M yy",RFC_1123:"D, d M yyyy",RFC_2822:"D, d M yyyy",RSS:"D, d M yy",TICKS:"!",TIMESTAMP:"@",W3C:"yyyy-mm-dd",formatDate:function(a,b,c){if("string"!=typeof a&&(c=b,b=a,a=""),!b)return"";a=a||this._defaults.dateFormat,c=c||{};for(var d=c.dayNamesShort||this._defaults.dayNamesShort,e=c.dayNames||this._defaults.dayNames,f=c.monthNamesShort||this._defaults.monthNamesShort,g=c.monthNames||this._defaults.monthNames,h=c.calculateWeek||this._defaults.calculateWeek,i=function(b,c){for(var d=1;n+d<a.length&&a.charAt(n+d)==b;)d++;return n+=d-1,Math.floor(d/(c||1))>1},j=function(a,b,c,d){var e=""+b;if(i(a,d))for(;e.length<c;)e="0"+e;return e},k=function(a,b,c,d){return i(a)?d[b]:c[b]},l="",m=!1,n=0;n<a.length;n++)if(m)"'"!=a.charAt(n)||i("'")?l+=a.charAt(n):m=!1;else switch(a.charAt(n)){case"d":l+=j("d",b.getDate(),2);break;case"D":l+=k("D",b.getDay(),d,e);break;case"o":l+=j("o",this.dayOfYear(b),3);break;case"w":l+=j("w",h(b),2);break;case"m":l+=j("m",b.getMonth()+1,2);break;case"M":l+=k("M",b.getMonth(),f,g);break;case"y":l+=i("y",2)?b.getFullYear():(b.getFullYear()%100<10?"0":"")+b.getFullYear()%100;break;case"@":l+=Math.floor(b.getTime()/1e3);break;case"!":l+=1e4*b.getTime()+this._ticksTo1970;break;case"'":i("'")?l+="'":m=!0;break;default:l+=a.charAt(n)}return l},parseDate:function(a,b,c){if(null==b)throw"Invalid arguments";if(b="object"==typeof b?b.toString():b+"",""==b)return null;a=a||this._defaults.dateFormat,c=c||{};var d=c.shortYearCutoff||this._defaults.shortYearCutoff;d="string"!=typeof d?d:this.today().getFullYear()%100+parseInt(d,10);for(var e=c.dayNamesShort||this._defaults.dayNamesShort,f=c.dayNames||this._defaults.dayNames,g=c.monthNamesShort||this._defaults.monthNamesShort,h=c.monthNames||this._defaults.monthNames,i=-1,j=-1,k=-1,l=-1,m=!1,n=!1,o=function(b,c){for(var d=1;t+d<a.length&&a.charAt(t+d)==b;)d++;return t+=d-1,Math.floor(d/(c||1))>1},p=function(a,c){var d=o(a,c),e=[2,3,d?4:2,11,20]["oy@!".indexOf(a)+1],f=new RegExp("^-?\\d{1,"+e+"}"),g=b.substring(s).match(f);if(!g)throw"Missing number at position {0}".replace(/\{0\}/,s);return s+=g[0].length,parseInt(g[0],10)},q=function(a,c,d,e){for(var f=o(a,e)?d:c,g=0;g<f.length;g++)if(b.substr(s,f[g].length).toLowerCase()==f[g].toLowerCase())return s+=f[g].length,g+1;throw"Unknown name at position {0}".replace(/\{0\}/,s)},r=function(){if(b.charAt(s)!=a.charAt(t))throw"Unexpected literal at position {0}".replace(/\{0\}/,s);s++},s=0,t=0;t<a.length;t++)if(n)"'"!=a.charAt(t)||o("'")?r():n=!1;else switch(a.charAt(t)){case"d":k=p("d");break;case"D":q("D",e,f);break;case"o":l=p("o");break;case"w":p("w");break;case"m":j=p("m");break;case"M":j=q("M",g,h);break;case"y":var u=t;m=!o("y",2),t=u,i=p("y",2);break;case"@":var v=this._normaliseDate(new Date(1e3*p("@")));i=v.getFullYear(),j=v.getMonth()+1,k=v.getDate();break;case"!":var v=this._normaliseDate(new Date((p("!")-this._ticksTo1970)/1e4));i=v.getFullYear(),j=v.getMonth()+1,k=v.getDate();break;case"*":s=b.length;break;case"'":o("'")?r():n=!0;break;default:r()}if(s<b.length)throw"Additional text found at end";if(-1==i?i=this.today().getFullYear():100>i&&m&&(i+=-1==d?1900:this.today().getFullYear()-this.today().getFullYear()%100-(d>=i?0:100)),l>-1){j=1,k=l;for(var w=this.daysInMonth(i,j);k>w;w=this.daysInMonth(i,j))j++,k-=w}var v=this.newDate(i,j,k);if(v.getFullYear()!=i||v.getMonth()+1!=j||v.getDate()!=k)throw"Invalid date";return v},determineDate:function(a,b,c,d,f){c&&"object"!=typeof c&&(f=d,d=c,c=null),"string"!=typeof d&&(f=d,d="");var g=function(a){try{return e.parseDate(d,a,f)}catch(b){}a=a.toLowerCase();for(var g=(a.match(/^c/)&&c?e.newDate(c):null)||e.today(),h=/([+-]?[0-9]+)\s*(d|w|m|y)?/g,i=null;i=h.exec(a);)g=e.add(g,parseInt(i[1],10),i[2]||"d");return g};return b=b?e.newDate(b):null,a=null==a?b:"string"==typeof a?g(a):"number"==typeof a?isNaN(a)||a==1/0||a==-(1/0)?b:e.add(e.today(),a,"d"):e.newDate(a)},daysInMonth:function(a,b){return b=a.getFullYear?a.getMonth()+1:b,a=a.getFullYear?a.getFullYear():a,this.newDate(a,b+1,0).getDate()},dayOfYear:function(a,b,c){var d=a.getFullYear?a:this.newDate(a,b,c),e=this.newDate(d.getFullYear(),1,1);return Math.floor((d.getTime()-e.getTime())/this._msPerDay)+1},iso8601Week:function(a,b,c){var d=a.getFullYear?new Date(a.getTime()):this.newDate(a,b,c);d.setDate(d.getDate()+4-(d.getDay()||7));var e=d.getTime();return d.setMonth(0,1),Math.floor(Math.round((e-d)/864e5)/7)+1},today:function(){return this._normaliseDate(new Date)},newDate:function(a,b,c){return a?a.getFullYear?this._normaliseDate(new Date(a.getTime())):new Date(a,b-1,c,12):null},_normaliseDate:function(a){return a&&a.setHours(12,0,0,0),a},year:function(a,b){return a.setFullYear(b),this._normaliseDate(a)},month:function(a,b){return a.setMonth(b-1),this._normaliseDate(a)},day:function(a,b){return a.setDate(b),this._normaliseDate(a)},add:function(a,b,c){if("d"==c||"w"==c)this._normaliseDate(a),a.setDate(a.getDate()+b*("w"==c?7:1));else{var d=a.getFullYear()+("y"==c?b:0),f=a.getMonth()+("m"==c?b:0);a.setTime(e.newDate(d,f+1,Math.min(a.getDate(),this.daysInMonth(d,f+1))).getTime())}return a},_applyMonthsOffset:function(b,c){var d=c.options.monthsOffset;return a.isFunction(d)&&(d=d.apply(c.target[0],[b])),e.add(b,-d,"m")},_attachPlugin:function(b,c){if(b=a(b),!b.hasClass(this.markerClassName)){var d=a.fn.metadata?b.metadata():{},f={options:a.extend({},this._defaults,d,c),target:b,selectedDates:[],drawDate:null,pickingRange:!1,inline:a.inArray(b[0].nodeName.toLowerCase(),["div","span"])>-1,get:function(b){return a.inArray(b,["defaultDate","minDate","maxDate"])>-1?e.determineDate(this.options[b],null,this.selectedDates[0],this.options.dateFormat,f.getConfig()):this.options[b]},curMinDate:function(){return this.pickingRange?this.selectedDates[0]:this.get("minDate")},getConfig:function(){
return{dayNamesShort:this.options.dayNamesShort,dayNames:this.options.dayNames,monthNamesShort:this.options.monthNamesShort,monthNames:this.options.monthNames,calculateWeek:this.options.calculateWeek,shortYearCutoff:this.options.shortYearCutoff}}};b.addClass(this.markerClassName).data(this.propertyName,f),f.inline?(f.drawDate=e._checkMinMax(e.newDate(f.selectedDates[0]||f.get("defaultDate")||e.today()),f),f.prevDate=e.newDate(f.drawDate),this._update(b[0]),a.fn.mousewheel&&b.mousewheel(this._doMouseWheel)):(this._attachments(b,f),b.bind("keydown."+this.propertyName,this._keyDown).bind("keypress."+this.propertyName,this._keyPress).bind("keyup."+this.propertyName,this._keyUp),b.attr("disabled")&&this._disablePlugin(b[0]))}},_optionPlugin:function(b,c,d){b=a(b);var f=b.data(this.propertyName);if(!c||"string"==typeof c&&null==d){var g=c;return c=(f||{}).options,c&&g?c[g]:c}if(b.hasClass(this.markerClassName)){if(c=c||{},"string"==typeof c){var g=c;c={},c[g]=d}if(c.calendar&&c.calendar!=f.options.calendar){var h=function(a){return"object"==typeof f.options[a]?null:f.options[a]};c=a.extend({defaultDate:h("defaultDate"),minDate:h("minDate"),maxDate:h("maxDate")},c),f.selectedDates=[],f.drawDate=null}var i=f.selectedDates;a.extend(f.options,c),this._setDatePlugin(b[0],i,null,!1,!0),f.pickingRange=!1,f.drawDate=e.newDate(this._checkMinMax((f.options.defaultDate?f.get("defaultDate"):f.drawDate)||f.get("defaultDate")||e.today(),f)),f.inline||this._attachments(b,f),(f.inline||f.div)&&this._update(b[0])}},_attachments:function(b,c){b.unbind("focus."+this.propertyName),c.options.showOnFocus&&b.bind("focus."+this.propertyName,this._showPlugin),c.trigger&&c.trigger.remove();var d=c.options.showTrigger;c.trigger=d?a(d).clone().removeAttr("id").addClass(this._triggerClass)[c.options.isRTL?"insertBefore":"insertAfter"](b).click(function(){e._isDisabledPlugin(b[0])||e[e.curInst==c?"_hidePlugin":"_showPlugin"](b[0])}):a([]),this._autoSize(b,c);var f=this._extractDates(c,b.val());f&&this._setDatePlugin(b[0],f,null,!0);var g=c.get("defaultDate");c.options.selectDefaultDate&&g&&0==c.selectedDates.length&&this._setDatePlugin(b[0],e.newDate(g||e.today()))},_autoSize:function(a,b){if(b.options.autoSize&&!b.inline){var c=e.newDate(2009,10,20),d=b.options.dateFormat;if(d.match(/[DM]/)){var f=function(a){for(var b=0,c=0,d=0;d<a.length;d++)a[d].length>b&&(b=a[d].length,c=d);return c};c.setMonth(f(b.options[d.match(/MM/)?"monthNames":"monthNamesShort"])),c.setDate(f(b.options[d.match(/DD/)?"dayNames":"dayNamesShort"])+20-c.getDay())}b.target.attr("size",e.formatDate(d,c,b.getConfig()).length)}},_destroyPlugin:function(b){if(b=a(b),b.hasClass(this.markerClassName)){var c=b.data(this.propertyName);c.trigger&&c.trigger.remove(),b.removeClass(this.markerClassName).removeData(this.propertyName).empty().unbind("."+this.propertyName),c.inline&&a.fn.mousewheel&&b.unmousewheel(),!c.inline&&c.options.autoSize&&b.removeAttr("size")}},multipleEvents:function(a){var b=arguments;return function(a){for(var c=0;c<b.length;c++)b[c].apply(this,arguments)}},_enablePlugin:function(b){if(b=a(b),b.hasClass(this.markerClassName)){var c=b.data(this.propertyName);c.inline?b.children("."+this._disableClass).remove().end().find("button,select").removeAttr("disabled").end().find("a").attr("href","javascript:void(0)"):(b.prop("disabled",!1),c.trigger.filter("button."+this._triggerClass).removeAttr("disabled").end().filter("img."+this._triggerClass).css({opacity:"1.0",cursor:""})),this._disabled=a.map(this._disabled,function(a){return a==b[0]?null:a})}},_disablePlugin:function(b){if(b=a(b),b.hasClass(this.markerClassName)){var c=b.data(this.propertyName);if(c.inline){var d=b.children(":last"),e=d.offset(),f={left:0,top:0};d.parents().each(function(){return"relative"==a(this).css("position")?(f=a(this).offset(),!1):void 0});var g=b.css("zIndex");g=("auto"==g?0:parseInt(g,10))+1,b.prepend('<div class="'+this._disableClass+'" style="width: '+d.outerWidth()+"px; height: "+d.outerHeight()+"px; left: "+(e.left-f.left)+"px; top: "+(e.top-f.top)+"px; z-index: "+g+'"></div>').find("button,select").attr("disabled","disabled").end().find("a").removeAttr("href")}else b.prop("disabled",!0),c.trigger.filter("button."+this._triggerClass).attr("disabled","disabled").end().filter("img."+this._triggerClass).css({opacity:"0.5",cursor:"default"});this._disabled=a.map(this._disabled,function(a){return a==b[0]?null:a}),this._disabled.push(b[0])}},_isDisabledPlugin:function(b){return b&&a.inArray(b,this._disabled)>-1},_showPlugin:function(b){b=a(b.target||b);var c=b.data(e.propertyName);if(e.curInst!=c&&(e.curInst&&e._hidePlugin(e.curInst,!0),c)){c.lastVal=null,c.selectedDates=e._extractDates(c,b.val()),c.pickingRange=!1,c.drawDate=e._checkMinMax(e.newDate(c.selectedDates[0]||c.get("defaultDate")||e.today()),c),c.prevDate=e.newDate(c.drawDate),e.curInst=c,e._update(b[0],!0);var d=e._checkOffset(c);c.div.css({left:d.left,top:d.top});var f=c.options.showAnim,g=c.options.showSpeed;if(g="normal"==g&&a.ui&&a.ui.version>="1.8"?"_default":g,a.effects&&a.effects[f]){var h=c.div.data();for(var i in h)i.match(/^ec\.storage\./)&&(h[i]=c._mainDiv.css(i.replace(/ec\.storage\./,"")));c.div.data(h).show(f,c.options.showOptions,g)}else c.div[f||"show"](f?g:"")}},_extractDates:function(a,b){if(b!=a.lastVal){a.lastVal=b,b=b.split(a.options.multiSelect?a.options.multiSeparator:a.options.rangeSelect?a.options.rangeSeparator:"\x00");for(var c=[],d=0;d<b.length;d++)try{var f=e.parseDate(a.options.dateFormat,b[d],a.getConfig());if(f){for(var g=!1,h=0;h<c.length;h++)if(c[h].getTime()==f.getTime()){g=!0;break}g||c.push(f)}}catch(i){}return c.splice(a.options.multiSelect||(a.options.rangeSelect?2:1),c.length),a.options.rangeSelect&&1==c.length&&(c[1]=c[0]),c}},_update:function(b,c){b=a(b.target||b);var d=b.data(e.propertyName);d&&((d.inline||e.curInst==d)&&(!a.isFunction(d.options.onChangeMonthYear)||d.prevDate&&d.prevDate.getFullYear()==d.drawDate.getFullYear()&&d.prevDate.getMonth()==d.drawDate.getMonth()||d.options.onChangeMonthYear.apply(b[0],[d.drawDate.getFullYear(),d.drawDate.getMonth()+1])),d.inline?b.html(this._generateContent(b[0],d)):e.curInst==d&&(d.div||(d.div=a("<div></div>").addClass(this._popupClass).css({display:c?"none":"static",position:"absolute",left:b.offset().left,top:b.offset().top+b.outerHeight()}).appendTo(a(d.options.popupContainer||"body")),a.fn.mousewheel&&d.div.mousewheel(this._doMouseWheel)),d.div.html(this._generateContent(b[0],d)),b.focus()))},_updateInput:function(b,c){var d=a.data(b,this.propertyName);if(d){for(var f="",g="",h=d.options.multiSelect?d.options.multiSeparator:d.options.rangeSeparator,i=d.options.altFormat||d.options.dateFormat,j=0;j<d.selectedDates.length;j++)f+=c?"":(j>0?h:"")+e.formatDate(d.options.dateFormat,d.selectedDates[j],d.getConfig()),g+=(j>0?h:"")+e.formatDate(i,d.selectedDates[j],d.getConfig());d.inline||c||a(b).val(f),a(d.options.altField).val(g),!a.isFunction(d.options.onSelect)||c||d.inSelect||(d.inSelect=!0,d.options.onSelect.apply(b,[d.selectedDates]),d.inSelect=!1)}},_getBorders:function(a){var b=function(a){return{thin:1,medium:3,thick:5}[a]||a};return[parseFloat(b(a.css("border-left-width"))),parseFloat(b(a.css("border-top-width")))]},_checkOffset:function(b){var c=b.target.is(":hidden")&&b.trigger?b.trigger:b.target,d=c.offset(),e=a(window).width(),f=a(window).height();if(0==e)return d;var g=!1;a(b.target).parents().each(function(){return g|="fixed"==a(this).css("position"),!g});var h=document.documentElement.scrollLeft||document.body.scrollLeft,i=document.documentElement.scrollTop||document.body.scrollTop,j=d.top-(g?i:0)-b.div.outerHeight(),k=d.top-(g?i:0)+c.outerHeight(),l=d.left-(g?h:0),m=d.left-(g?h:0)+c.outerWidth()-b.div.outerWidth(),n=d.left-h+b.div.outerWidth()>e,o=d.top-i+b.target.outerHeight()+b.div.outerHeight()>f;b.div.css("position",g?"fixed":"absolute");var p=b.options.alignment;return d="topLeft"==p?{left:l,top:j}:"topRight"==p?{left:m,top:j}:"bottomLeft"==p?{left:l,top:k}:"bottomRight"==p?{left:m,top:k}:"top"==p?{left:b.options.isRTL||n?m:l,top:j}:{left:b.options.isRTL||n?m:l,top:o?j:k},d.left=Math.max(g?0:h,d.left),d.top=Math.max(g?0:i,d.top),d},_checkExternalClick:function(b){if(e.curInst){var c=a(b.target);c.parents().andSelf().hasClass(e._popupClass)||c.hasClass(e.markerClassName)||c.parents().andSelf().hasClass(e._triggerClass)||e._hidePlugin(e.curInst)}},_hidePlugin:function(b,c){if(b){var d=a.data(b,this.propertyName)||b;if(d&&d==e.curInst){var f=c?"":d.options.showAnim,g=d.options.showSpeed;g="normal"==g&&a.ui&&a.ui.version>="1.8"?"_default":g;var h=function(){d.div&&(d.div.remove(),d.div=null,e.curInst=null,a.isFunction(d.options.onClose)&&d.options.onClose.apply(b,[d.selectedDates]))};if(d.div.stop(),a.effects&&a.effects[f])d.div.hide(f,d.options.showOptions,g,h);else{var i="slideDown"==f?"slideUp":"fadeIn"==f?"fadeOut":"hide";d.div[i](f?g:"",h)}f||h()}}},_keyDown:function(b){var c=b.target,d=a.data(c,e.propertyName),f=!1;if(d.div)if(9==b.keyCode)e._hidePlugin(c);else if(13==b.keyCode)e._selectDatePlugin(c,a("a."+d.options.renderer.highlightedClass,d.div)[0]),f=!0;else{var g=d.options.commands;for(var h in g){var i=g[h];if(i.keystroke.keyCode==b.keyCode&&!!i.keystroke.ctrlKey==!(!b.ctrlKey&&!b.metaKey)&&!!i.keystroke.altKey==b.altKey&&!!i.keystroke.shiftKey==b.shiftKey){e._performActionPlugin(c,h),f=!0;break}}}else{var i=d.options.commands.current;i.keystroke.keyCode==b.keyCode&&!!i.keystroke.ctrlKey==!(!b.ctrlKey&&!b.metaKey)&&!!i.keystroke.altKey==b.altKey&&!!i.keystroke.shiftKey==b.shiftKey&&(e._showPlugin(c),f=!0)}return d.ctrlKey=b.keyCode<48&&32!=b.keyCode||b.ctrlKey||b.metaKey,f&&(b.preventDefault(),b.stopPropagation()),!f},_keyPress:function(b){var c=a.data(b.target,e.propertyName);if(c&&c.options.constrainInput){var d=String.fromCharCode(b.keyCode||b.charCode),f=e._allowedChars(c);return b.metaKey||c.ctrlKey||" ">d||!f||f.indexOf(d)>-1}return!0},_allowedChars:function(a){for(var b=a.options.multiSelect?a.options.multiSeparator:a.options.rangeSelect?a.options.rangeSeparator:"",c=!1,d=!1,e=a.options.dateFormat,f=0;f<e.length;f++){var g=e.charAt(f);if(c)"'"==g&&"'"!=e.charAt(f+1)?c=!1:b+=g;else switch(g){case"d":case"m":case"o":case"w":b+=d?"":"0123456789",d=!0;break;case"y":case"@":case"!":b+=(d?"":"0123456789")+"-",d=!0;break;case"J":b+=(d?"":"0123456789")+"-.",d=!0;break;case"D":case"M":case"Y":return null;case"'":"'"==e.charAt(f+1)?b+="'":c=!0;break;default:b+=g}}return b},_keyUp:function(b){var c=b.target,d=a.data(c,e.propertyName);if(d&&!d.ctrlKey&&d.lastVal!=d.target.val())try{var f=e._extractDates(d,d.target.val());f.length>0&&e._setDatePlugin(c,f,null,!0)}catch(b){}return!0},_doMouseWheel:function(b,c){var d=e.curInst&&e.curInst.target[0]||a(b.target).closest("."+e.markerClassName)[0];if(!e._isDisabledPlugin(d)){var f=a.data(d,e.propertyName);f.options.useMouseWheel&&(c=0>c?-1:1,e._changeMonthPlugin(d,-f.options[b.ctrlKey?"monthsToJump":"monthsToStep"]*c)),b.preventDefault()}},_clearPlugin:function(b){var c=a.data(b,this.propertyName);if(c){c.selectedDates=[],this._hidePlugin(b);var d=c.get("defaultDate");c.options.selectDefaultDate&&d?this._setDatePlugin(b,e.newDate(d||e.today())):this._updateInput(b)}},_getDatePlugin:function(b){var c=a.data(b,this.propertyName);return c?c.selectedDates:[]},_setDatePlugin:function(b,c,d,f,g){var h=a.data(b,this.propertyName);if(h){a.isArray(c)||(c=[c],d&&c.push(d));var i=h.get("minDate"),j=h.get("maxDate"),k=h.selectedDates[0];h.selectedDates=[];for(var l=0;l<c.length;l++){var m=e.determineDate(c[l],null,k,h.options.dateFormat,h.getConfig());if(m&&(!i||m.getTime()>=i.getTime())&&(!j||m.getTime()<=j.getTime())){for(var n=!1,o=0;o<h.selectedDates.length;o++)if(h.selectedDates[o].getTime()==m.getTime()){n=!0;break}n||h.selectedDates.push(m)}}if(h.selectedDates.splice(h.options.multiSelect||(h.options.rangeSelect?2:1),h.selectedDates.length),h.options.rangeSelect){switch(h.selectedDates.length){case 1:h.selectedDates[1]=h.selectedDates[0];break;case 2:h.selectedDates[1]=h.selectedDates[0].getTime()>h.selectedDates[1].getTime()?h.selectedDates[0]:h.selectedDates[1]}h.pickingRange=!1}h.prevDate=h.drawDate?e.newDate(h.drawDate):null,h.drawDate=this._checkMinMax(e.newDate(h.selectedDates[0]||h.get("defaultDate")||e.today()),h),g||(this._update(b),this._updateInput(b,f))}},_isSelectablePlugin:function(b,c){var d=a.data(b,this.propertyName);return d?(c=e.determineDate(c,d.selectedDates[0]||this.today(),null,d.options.dateFormat,d.getConfig()),this._isSelectable(b,c,d.options.onDate,d.get("minDate"),d.get("maxDate"))):!1},_isSelectable:function(b,c,d,e,f){var g="boolean"==typeof d?{selectable:d}:a.isFunction(d)?d.apply(b,[c,!0]):{};return 0!=g.selectable&&(!e||c.getTime()>=e.getTime())&&(!f||c.getTime()<=f.getTime())},_performActionPlugin:function(b,c){var d=a.data(b,this.propertyName);if(d&&!this._isDisabledPlugin(b)){var e=d.options.commands;e[c]&&e[c].enabled.apply(b,[d])&&e[c].action.apply(b,[d])}},_showMonthPlugin:function(b,c,d,f){var g=a.data(b,this.propertyName);if(g&&(null!=f||g.drawDate.getFullYear()!=c||g.drawDate.getMonth()+1!=d)){g.prevDate=e.newDate(g.drawDate);var h=this._checkMinMax(null!=c?e.newDate(c,d,1):e.today(),g);g.drawDate=e.newDate(h.getFullYear(),h.getMonth()+1,null!=f?f:Math.min(g.drawDate.getDate(),e.daysInMonth(h.getFullYear(),h.getMonth()+1))),this._update(b)}},_changeMonthPlugin:function(b,c){var d=a.data(b,this.propertyName);if(d){var f=e.add(e.newDate(d.drawDate),c,"m");this._showMonthPlugin(b,f.getFullYear(),f.getMonth()+1)}},_changeDayPlugin:function(b,c){var d=a.data(b,this.propertyName);if(d){var f=e.add(e.newDate(d.drawDate),c,"d");this._showMonthPlugin(b,f.getFullYear(),f.getMonth()+1,f.getDate())}},_checkMinMax:function(a,b){var c=b.get("minDate"),d=b.get("maxDate");return a=c&&a.getTime()<c.getTime()?e.newDate(c):a,a=d&&a.getTime()>d.getTime()?e.newDate(d):a},_retrieveDatePlugin:function(b,c){var d=a.data(b,this.propertyName);return d?this._normaliseDate(new Date(parseInt(c.className.replace(/^.*dp(-?\d+).*$/,"$1"),10))):null},_selectDatePlugin:function(b,c){var d=a.data(b,this.propertyName);if(d&&!this._isDisabledPlugin(b)){var f=this._retrieveDatePlugin(b,c);if(d.options.multiSelect){for(var g=!1,h=0;h<d.selectedDates.length;h++)if(f.getTime()==d.selectedDates[h].getTime()){d.selectedDates.splice(h,1),g=!0;break}!g&&d.selectedDates.length<d.options.multiSelect&&d.selectedDates.push(f)}else d.options.rangeSelect?(d.pickingRange?d.selectedDates[1]=f:d.selectedDates=[f,f],d.pickingRange=!d.pickingRange):d.selectedDates=[f];d.prevDate=e.newDate(f),this._updateInput(b),d.inline||d.pickingRange||d.selectedDates.length<(d.options.multiSelect||(d.options.rangeSelect?2:1))?this._update(b):this._hidePlugin(b)}},_generateContent:function(b,c){var d=c.options.monthsToShow;d=a.isArray(d)?d:[1,d],c.drawDate=this._checkMinMax(c.drawDate||c.get("defaultDate")||e.today(),c);for(var f=e._applyMonthsOffset(e.newDate(c.drawDate),c),g="",h=0;h<d[0];h++){for(var i="",j=0;j<d[1];j++)i+=this._generateMonth(b,c,f.getFullYear(),f.getMonth()+1,c.options.renderer,0==h&&0==j),e.add(f,1,"m");g+=this._prepare(c.options.renderer.monthRow,c).replace(/\{months\}/,i)}var k=this._prepare(c.options.renderer.picker,c).replace(/\{months\}/,g).replace(/\{weekHeader\}/g,this._generateDayHeaders(c,c.options.renderer)),l=function(a,d,f,g,h){if(-1!=k.indexOf("{"+a+":"+g+"}")){var i=c.options.commands[g],j=c.options.commandsAsDateFormat?i.date.apply(b,[c]):null;k=k.replace(new RegExp("\\{"+a+":"+g+"\\}","g"),"<"+d+(i.status?' title="'+c.options[i.status]+'"':"")+' class="'+c.options.renderer.commandClass+" "+c.options.renderer.commandClass+"-"+g+" "+h+(i.enabled(c)?"":" "+c.options.renderer.disabledClass)+'">'+(j?e.formatDate(c.options[i.text],j,c.getConfig()):c.options[i.text])+"</"+f+">")}};for(var m in c.options.commands)l("button",'button type="button"',"button",m,c.options.renderer.commandButtonClass),l("link",'a href="javascript:void(0)"',"a",m,c.options.renderer.commandLinkClass);if(k=a(k),d[1]>1){var n=0;a(c.options.renderer.monthSelector,k).each(function(){var b=++n%d[1];a(this).addClass(1==b?"first":0==b?"last":"")})}var o=this;k.find(c.options.renderer.daySelector+" a").hover(function(){a(this).addClass(c.options.renderer.highlightedClass)},function(){(c.inline?a(this).parents("."+o.markerClassName):c.div).find(c.options.renderer.daySelector+" a").removeClass(c.options.renderer.highlightedClass)}).click(function(){o._selectDatePlugin(b,this)}).end().find("select."+this._monthYearClass+":not(."+this._anyYearClass+")").change(function(){var c=a(this).val().split("/");o._showMonthPlugin(b,parseInt(c[1],10),parseInt(c[0],10))}).end().find("select."+this._anyYearClass).click(function(){a(this).css("visibility","hidden").next("input").css({left:this.offsetLeft,top:this.offsetTop,width:this.offsetWidth,height:this.offsetHeight}).show().focus()}).end().find("input."+o._monthYearClass).change(function(){try{var d=parseInt(a(this).val(),10);d=isNaN(d)?c.drawDate.getFullYear():d,o._showMonthPlugin(b,d,c.drawDate.getMonth()+1,c.drawDate.getDate())}catch(e){alert(e)}}).keydown(function(b){13==b.keyCode?a(b.target).change():27==b.keyCode&&(a(b.target).hide().prev("select").css("visibility","visible"),c.target.focus())}),k.find("."+c.options.renderer.commandClass).click(function(){if(!a(this).hasClass(c.options.renderer.disabledClass)){var d=this.className.replace(new RegExp("^.*"+c.options.renderer.commandClass+"-([^ ]+).*$"),"$1");e._performActionPlugin(b,d)}}),c.options.isRTL&&k.addClass(c.options.renderer.rtlClass),d[0]*d[1]>1&&k.addClass(c.options.renderer.multiClass),c.options.pickerClass&&k.addClass(c.options.pickerClass),a("body").append(k);var p=0;return k.find(c.options.renderer.monthSelector).each(function(){p+=a(this).outerWidth()}),k.width(p/d[0]),a.isFunction(c.options.onShow)&&c.options.onShow.apply(b,[k,c]),k},_generateMonth:function(b,c,d,f,g,h){var i=e.daysInMonth(d,f),j=c.options.monthsToShow;j=a.isArray(j)?j:[1,j];var k=c.options.fixedWeeks||j[0]*j[1]>1,l=c.options.firstDay,m=(e.newDate(d,f,1).getDay()-l+7)%7,n=k?6:Math.ceil((m+i)/7),o=c.options.selectOtherMonths&&c.options.showOtherMonths,p=c.pickingRange?c.selectedDates[0]:c.get("minDate"),q=c.get("maxDate"),r=g.week.indexOf("{weekOfYear}")>-1,s=e.today(),t=e.newDate(d,f,1);e.add(t,-m-(k&&t.getDay()==l?7:0),"d");for(var u=t.getTime(),v="",w=0;n>w;w++){for(var x=r?'<span class="dp'+u+'">'+(a.isFunction(c.options.calculateWeek)?c.options.calculateWeek(t):0)+"</span>":"",y="",z=0;7>z;z++){var A=!1;if(c.options.rangeSelect&&c.selectedDates.length>0)A=t.getTime()>=c.selectedDates[0]&&t.getTime()<=c.selectedDates[1];else for(var B=0;B<c.selectedDates.length;B++)if(c.selectedDates[B].getTime()==t.getTime()){A=!0;break}var C=a.isFunction(c.options.onDate)?c.options.onDate.apply(b,[t,t.getMonth()+1==f]):{},D=(o||t.getMonth()+1==f)&&this._isSelectable(b,t,C.selectable,p,q);y+=this._prepare(g.day,c).replace(/\{day\}/g,(D?'<a href="javascript:void(0)"':"<span")+' class="dp'+u+" "+(C.dateClass||"")+(A&&(o||t.getMonth()+1==f)?" "+g.selectedClass:"")+(D?" "+g.defaultClass:"")+((t.getDay()||7)<6?"":" "+g.weekendClass)+(t.getMonth()+1==f?"":" "+g.otherMonthClass)+(t.getTime()==s.getTime()&&t.getMonth()+1==f?" "+g.todayClass:"")+(t.getTime()==c.drawDate.getTime()&&t.getMonth()+1==f?" "+g.highlightedClass:"")+'"'+(C.title||c.options.dayStatus&&D?' title="'+(C.title||e.formatDate(c.options.dayStatus,t,c.getConfig()))+'"':"")+">"+(c.options.showOtherMonths||t.getMonth()+1==f?C.content||t.getDate():"&nbsp;")+(D?"</a>":"</span>")),e.add(t,1,"d"),u=t.getTime()}v+=this._prepare(g.week,c).replace(/\{days\}/g,y).replace(/\{weekOfYear\}/g,x)}var E=this._prepare(g.month,c).match(/\{monthHeader(:[^\}]+)?\}/);E=E[0].length<=13?"MM yyyy":E[0].substring(13,E[0].length-1),E=h?this._generateMonthSelection(c,d,f,p,q,E,g):e.formatDate(E,e.newDate(d,f,1),c.getConfig());var F=this._prepare(g.weekHeader,c).replace(/\{days\}/g,this._generateDayHeaders(c,g));return this._prepare(g.month,c).replace(/\{monthHeader(:[^\}]+)?\}/g,E).replace(/\{weekHeader\}/g,F).replace(/\{weeks\}/g,v)},_generateDayHeaders:function(a,b){for(var c="",d=0;7>d;d++){var e=(d+a.options.firstDay)%7;c+=this._prepare(b.dayHeader,a).replace(/\{day\}/g,'<span class="'+this._curDoWClass+e+'" title="'+a.options.dayNames[e]+'">'+a.options.dayNamesMin[e]+"</span>")}return c},_generateMonthSelection:function(a,b,c,d,f,g){if(!a.options.changeMonth)return e.formatDate(g,e.newDate(b,c,1),a.getConfig());for(var h=a.options["monthNames"+(g.match(/mm/i)?"":"Short")],i=g.replace(/m+/i,"\\x2E").replace(/y+/i,"\\x2F"),j='<select class="'+this._monthYearClass+'" title="'+a.options.monthStatus+'">',k=1;12>=k;k++)(!d||e.newDate(b,k,e.daysInMonth(b,k)).getTime()>=d.getTime())&&(!f||e.newDate(b,k,1).getTime()<=f.getTime())&&(j+='<option value="'+k+"/"+b+'"'+(c==k?' selected="selected"':"")+">"+h[k-1]+"</option>");j+="</select>",i=i.replace(/\\x2E/,j);var l=a.options.yearRange;if("any"==l)j='<select class="'+this._monthYearClass+" "+this._anyYearClass+'" title="'+a.options.yearStatus+'"><option>'+b+'</option></select><input class="'+this._monthYearClass+" "+this._curMonthClass+c+'" value="'+b+'">';else{l=l.split(":");var m=e.today().getFullYear(),n=l[0].match("c[+-].*")?b+parseInt(l[0].substring(1),10):(l[0].match("[+-].*")?m:0)+parseInt(l[0],10),o=l[1].match("c[+-].*")?b+parseInt(l[1].substring(1),10):(l[1].match("[+-].*")?m:0)+parseInt(l[1],10);j='<select class="'+this._monthYearClass+'" title="'+a.options.yearStatus+'">',n=e.add(e.newDate(n+1,1,1),-1,"d"),o=e.newDate(o,1,1);var p=function(a){0!=a&&(j+='<option value="'+c+"/"+a+'"'+(b==a?' selected="selected"':"")+">"+a+"</option>")};if(n.getTime()<o.getTime()){n=(d&&d.getTime()>n.getTime()?d:n).getFullYear(),o=(f&&f.getTime()<o.getTime()?f:o).getFullYear();for(var q=n;o>=q;q++)p(q)}else{n=(f&&f.getTime()<n.getTime()?f:n).getFullYear(),o=(d&&d.getTime()>o.getTime()?d:o).getFullYear();for(var q=n;q>=o;q--)p(q)}j+="</select>"}return i=i.replace(/\\x2F/,j)},_prepare:function(a,b){var c=function(b,c){for(;;){var d=a.indexOf("{"+b+":start}");if(-1==d)return;var e=a.substring(d).indexOf("{"+b+":end}");e>-1&&(a=a.substring(0,d)+(c?a.substr(d+b.length+8,e-b.length-8):"")+a.substring(d+e+b.length+6))}};c("inline",b.inline),c("popup",!b.inline);for(var d=/\{l10n:([^\}]+)\}/,e=null;e=d.exec(a);)a=a.replace(e[0],b.options[e[1]]);return a}});var d=["getDate","isDisabled","isSelectable","retrieveDate"];a.fn.datepick=function(a){var b=Array.prototype.slice.call(arguments,1);return c(a,b)?e["_"+a+"Plugin"].apply(e,[this[0]].concat(b)):this.each(function(){if("string"==typeof a){if(!e["_"+a+"Plugin"])throw"Unknown command: "+a;e["_"+a+"Plugin"].apply(e,[this].concat(b))}else e._attachPlugin(this,a||{})})};var e=a.datepick=new b;a(function(){a(document).mousedown(e._checkExternalClick).resize(function(){e._hidePlugin(e.curInst)})})}(a)}"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(["angular","jquery","lodash","moment"],function(a,b,d,e){return c(a,b,d,e)}):"undefined"!=typeof angular&&null!==angular&&c(angular,$,_,moment)}).call(this);